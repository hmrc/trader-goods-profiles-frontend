@*
 * Copyright 2024 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import models.router.responses.GetGoodsRecordResponse
@import config.FrontendAppConfig
@import viewmodels.LabelSize._
@import models.Country._

@this(
    appConfig: FrontendAppConfig,
    layout: templates.Layout,
    formHelper: FormWithCSRF,
    govukErrorSummary: GovukErrorSummary,
    govukInput: GovukInput,
    govukButton: GovukButton,
    govukTable: GovukTable,
    tableRowActionList: components.TableRowActionList,
    boldWrapper: components.BoldWrapper,
    govukPagination: GovukPagination,
    govukSelect: GovukSelect,
    tag: components.Tag
)

@(
    form: Form[_],
    goodsRecordsItems: Seq[GetGoodsRecordResponse],
    totalRecords: Int,
    firstRecord: Int,
    lastRecord: Int,
    countries: Seq[Country],
    pagination: Pagination,
    page: Int
)(implicit request: Request[_], messages: Messages)


@preparedTitle = @{
    pagination.items match {
        case Some(items) if (items.size > 1) => title(form, messages("goodsRecords.title.withPage", page, items.size))
        case _ => title(form, messages("goodsRecords.title"))
    }
}

@layout(
    pageTitle = preparedTitle, isFullWidth = true
  ) {

    @if(form.errors.nonEmpty) {
        @govukErrorSummary(ErrorSummaryViewModel(form))
    }
    <a href="#goodsRecords" class="govuk-skip-link" data-module="govuk-skip-link">@messages("goodsRecords.skip.record")</a>
    <a href="#main-content" class="govuk-skip-link" data-module="govuk-skip-link">@messages("goodsRecords.skip.main")</a>
<div class="govuk-width-container">
    <main class="govuk-main-wrapper" id="main-content">
        <div class="govuk-grid-row"><h1 class="govuk-heading-l">@messages("goodsRecords.title")</h1></div>

        <div class="govuk-grid-row">

            <div class="govuk-grid-column-one-third custom-box">
                <style>
                    .custom-box {
                      box-shadow: inset 0 0 0 1px #b1b4b6;
                      margin-top: -1px;
                      margin-bottom: -1px;
                      padding-top: 20px;
                      padding-right: 20px;
                      padding-bottom: 15px;
                      padding-left: 20px;
                               }
                </style>

                <h2 class="govuk-heading-m">@messages("goodsRecords.search")</h2>
                <p class="govuk-body"> @messages("goodsRecords.search.1")</p>

                @formHelper(action = controllers.goodsProfile.routes.GoodsRecordsController.onSearch(page), 'role -> "search") {

                <div class="govuk-label govuk-label--s">
                    @govukInput(
                    InputViewModel(
                    field = form("value"),
                    label = LabelViewModel(messages("goodsRecords.label")).withCssClass("govuk-!-font-weight-bold")
                    )
                    )

                </div>
                }
                <fieldset class="govuk-fieldset govuk-!-margin-top-4 govuk-!-margin-bottom-4" id="filters">
                    <legend class="govuk-fieldset__legend govuk-fieldset__legend--s">
                        @messages("goodsRecords.record")
                    </legend>
                    <div class="checkbox-group">
                        <div class="govuk-checkboxes__item">
                            <input class="govuk-checkboxes__input" id="status-ready" name="filterRecordStatus"
                                   type="checkbox" value="immi-ready">
                            <label class="govuk-label govuk-checkboxes__label" for="status-ready">
                                @messages("declarableStatus.immiReady")
                            </label>
                        </div>
                        <div class="govuk-checkboxes__item">
                            <input class="govuk-checkboxes__input" id="status-not-ready" name="filterRecordStatus"
                                   type="checkbox" value="not-immi-ready">
                            <label class="govuk-label govuk-checkboxes__label" for="status-not-ready">
                                @messages("declarableStatus.notReadyForImmi")
                            </label>
                        </div>
                        <div class="govuk-checkboxes__item">
                            <input class="govuk-checkboxes__input" id="status-action-needed" name="filterRecordStatus"
                                   type="checkbox" value="action-needed">
                            <label class="govuk-label govuk-checkboxes__label" for="status-action-needed">
                                @messages("declarableStatus.notReadyForUse")
                            </label>
                        </div>
                    </div>

                </fieldset>

                @govukSelect(
                SelectViewModel(
                field = form("value"),
                items = selectItems(countries),
                label = LabelViewModel(messages("goodsRecords.tableHeader.countryOfOrigin")).withSize(Small)
                )
                .withCssClass("autocomplete")
                .withAttribute(("lang", "en"))
                )

                <div class="govuk-button-group">

                    @govukButton(
                    ButtonViewModel(
                    content = HtmlContent(
                    s"""${messages("site.apply")}<span class="govuk-visually-hidden">${messages("goodsRecords.record.search")}</span>"""
                    )
                    ).withAttribute("style", "margin-left: 10px")
                    )

                    <a class="govuk-link" href="#">@messages("site.clear")<span class="govuk-visually-hidden"> @messages("goodsRecords.record.clear")</span></a>
                </div>
            </div>

            <div class="govuk-grid-column-two-thirds govuk-!-padding-left-20">
                <h2 class="govuk-heading-m">@messages("goodsRecords.h2.1")</h2>

                <p class="govuk-body">@messages("goodsRecords.p1")</p>

                <p class="govuk-body">@messages("goodsRecords.p2")
                    <strong class="govuk-tag govuk-tag--green">@messages("declarableStatus.immiReady")</strong></p>

                <p class="govuk-body">@messages("goodsRecords.p2.1")
                    <strong class="govuk-tag govuk-tag--orange">@messages("declarableStatus.notReadyForImmi")</strong>.
                    @messages("goodsRecords.p2.2")</p>

                <p class="govuk-body">@messages("goodsRecords.p2.3")
                    <strong class="govuk-tag govuk-tag--red">@messages("declarableStatus.notReadyForUse")</strong>.
                    @messages("goodsRecords.p2.4")</p>

                <p class="govuk-body"> @messages("goodsRecords.link1.text") <a
                        href="@controllers.goodsRecord.routes.CreateRecordStartController.onPageLoad().url"
                        class="govuk-link">@messages("goodsRecords.link1")</a></p>

            </div>
        </div>
    </main>
</div>


<div class="govuk-grid-column-full">
    <h3 class="govuk-heading-m" id="goodsRecords">@messages("goodsRecords.record.list")</h3>
    <p class="govuk-body">@Html(messages("goodsRecords.pagination", boldWrapper(firstRecord.toString()),
        boldWrapper(lastRecord.toString()), boldWrapper(totalRecords.toString())))</p>

        <div style="overflow-x: auto;">

        @govukTable(
            Table(
                caption = Some(messages("goodsRecords.title")),
                captionClasses = "govuk-visually-hidden",
                head = Some(Seq(
                    HeadCell(
                        content = Text(messages("goodsRecords.tableHeader.traderReference"))
                    ),
                    HeadCell(
                        content = Text(messages("goodsRecords.tableHeader.goodsDescription"))
                    ),
                    HeadCell(
                        content = Text(messages("goodsRecords.tableHeader.countryOfOrigin"))
                    ),
                    HeadCell(
                        content = Text(messages("goodsRecords.tableHeader.commodityCode"))
                    ),
                    HeadCell(
                        content = Text(messages("goodsRecords.tableHeader.status"))
                    ),
                    HeadCell(
                        content = Text(messages("goodsRecords.tableHeader.actions"))
                    )
                )),
                rows = goodsRecordsItems.map{
                    goodsRecord =>  Seq(
                        TableRow(
                            content = Text(goodsRecord.traderRef),
                            attributes = Map("style" -> "word-break: break-word")
                        ),
                        TableRow(
                            content = Text(goodsRecord.goodsDescription),
                            attributes = Map("style" -> "word-break: break-word")
                        ),
                        TableRow(
                            content = HtmlContent(
                                s"""<div lang="en">${
                                    countries
                                        .find(_.id == goodsRecord.countryOfOrigin)
                                        .map(_.description)
                                        .getOrElse(goodsRecord.countryOfOrigin)
                                }</div>"""
                            )
                        ),
                        TableRow(
                            content = Text(goodsRecord.comcode)
                        ),
                        TableRow(
                            content = HtmlContent(
                            tag(messages(goodsRecord.declarable.messageKey), goodsRecord.declarable.paragraphTagColour))

                         ),

                        TableRow(
                            content = HtmlContent(
                                tableRowActionList(
                                    text1 = messages("site.view"),
                                    text2 = messages("site.remove"),
                                    visuallyHiddenContent1 = goodsRecord.traderRef,
                                    visuallyHiddenContent2 = goodsRecord.traderRef,
                                    href1 = controllers.goodsRecord.routes.SingleRecordController.onPageLoad(goodsRecord.recordId).url,
                                    href2 = controllers.goodsProfile.routes.RemoveGoodsRecordController.onPageLoad(goodsRecord.recordId, GoodsProfileLocation).url,
                                    adviceStatus = goodsRecord.adviceStatus
                                )
                            )
                        )
                    )
                }
            )
        )

    </div>
        @govukPagination(pagination)

        <p class="govuk-body"><a href="@routes.HomePageController.onPageLoad().url" class="govuk-link">@messages("site.goBackToHomePage")</a></p>

</div>
}
